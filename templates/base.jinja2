<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Wazapp</title>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href='http://fonts.googleapis.com/css?family=Bangers' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/static/default.css">
    <style type="text/css">
      html, body, #map-canvas { width: 100%; height: 100%; margin: 0; padding: 0; display: block}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js">
    </script>
    <script src="static/jquery-2.1.3.min.js"></script>
    <script src="/static/mustache.min.js"></script>
  </head>
  <body>
    <header>
      <h1>Wazapp</h1>
    </header>
    <section id="content">
        <div id="map-canvas"></div>
        <div id="sidebar"></div>
    </section>
    <footer>
        <script type="text/javascript">
      var map;
      function initialize() {
        var mapOptions = {
          center: { lat: 47.645101, lng: 237.658112},
          zoom: 13
      };
        map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);
        map.data.loadGeoJson("/static/venue.json");

        map.data.addListener('click', function(event) {
          // console.log(event.feature)
          var address = event.feature["k"]["address"].slice(0, -5);
      
          // TODO: add tweets to sidebar 
          $.ajax({
              url: '/gettweets',
              type: 'GET',
              dataType: 'json',
              data: {'address': address},
              success: function(result){
                $('#sidebar').html("");
                var template = '<div class="tweet">'+
                                  '<span class="user">[[author_handle]]</span>'+
                                  '<span class="time">[[time]]</span>'+
                                  '<p class="content">[[content]]';


                var tweets = result.tweets;
                for(var tweet in tweets){
                  var html = Mustache.to_html(template, tweets[tweet]);
                  $('#sidebar').append(html);
                }
                // for (var tweet in tweets){
                //   console.log(tweet.content);
                // }
              },
          });

          $('#sidebar').addClass("sidebar--active");
        });
      }
      // Load geojson data
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    </footer>
  </body>
</html>